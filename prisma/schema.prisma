// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  GUEST
  TOURIST
  GUIDE
  ADMIN
}

model User {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  password     String
  role         UserRole @default(TOURIST)
  avatar       String?
  bio          String?
  location     String?
  languages    String[]
  isPro        Boolean  @default(false)
  joinedDate   DateTime @default(now())
  tours        Tour[]   @relation("GuideTours")
  bookings     Booking[]
  reviews      Review[]
  blogPosts    BlogPost[]
  stories      Story[]
  stamps       PassportStamp[]
}

model Tour {
  id           String   @id @default(uuid())
  title        String
  description  String
  itinerary    String
  city         String
  country      String
  category     String
  images       String[]
  price        Float
  duration     String
  meetingPoint String
  maxGroupSize Int
  guideId      String
  guide        User     @relation("GuideTours", fields: [guideId], references: [id])
  rating       Float    @default(0)
  reviewCount  Int      @default(0)
  languages    String[]
  latitude     Float?
  longitude    Float?
  bookings     Booking[]
  reviews      Review[]
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

model Booking {
  id           String        @id @default(uuid())
  tourId       String
  tour         Tour          @relation(fields: [tourId], references: [id])
  touristId    String
  tourist      User          @relation(fields: [touristId], references: [id])
  date         DateTime
  status       BookingStatus @default(PENDING)
  totalPrice   Float
  guests       Int
  paymentId    String?
  createdAt    DateTime      @default(now())
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  tourId    String
  tour      Tour     @relation(fields: [tourId], references: [id])
  rating    Int
  comment   String
  createdAt DateTime @default(now())
}

model BlogPost {
  id        String   @id @default(uuid())
  title     String
  excerpt   String
  content   String
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  date      DateTime @default(now())
  image     String
  category  String
  readTime  String
}

model Story {
  id        String   @id @default(uuid())
  guideId   String
  guide     User     @relation(fields: [guideId], references: [id])
  image     String
  caption   String
  location  String
  timestamp DateTime @default(now())
}

model PassportStamp {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  city      String
  country   String
  date      DateTime
  tourTitle String
  color     String
  rotation  Float
}

model Offer {
  id             String      @id @default(uuid())
  code           String      @unique
  title          String
  description    String
  discountAmount Float
  discountType   OfferType
  expiryDate     DateTime
  minSpend       Float?
  image          String
  color          String
}

enum OfferType {
  PERCENTAGE
  FIXED
}
